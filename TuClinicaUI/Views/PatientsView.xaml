<UserControl x:Class="TuClinica.UI.Views.PatientsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             
      
 
             xmlns:converters="clr-namespace:TuClinica.UI.Converters"
             xmlns:viewmodels="clr-namespace:TuClinica.UI.ViewModels"
             d:DataContext="{d:DesignInstance Type=viewmodels:PatientsViewModel}"
             
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">

    <UserControl.Resources>
        <ResourceDictionary>

            <converters:BooleanToVisibilityConverter 
 x:Key="BooleanToVisibilityConverter"/>

        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="20">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <FrameworkElement x:Name="BindingProxy" Visibility="Collapsed" DataContext="{Binding}" 
           
                  Grid.Row="0" Grid.Column="0" />
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>

                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox 
 Grid.Column="0" 
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     mah:TextBoxHelper.Watermark="Buscar por 
 nombre o DNI..." 
                     VerticalAlignment="Center"/>

            <CheckBox Grid.Column="1"
                 
        Content="Mostrar pacientes archivados"
                      IsChecked="{Binding ShowInactivePatients}"
                
       Margin="15,0,0,0"
                      VerticalAlignment="Center"/>
        </Grid>


        <Grid Grid.Row="1">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>

            </Grid.ColumnDefinitions>


            <DataGrid Grid.Column="0" 
                      ItemsSource="{Binding Patients}" 
            
             SelectedItem="{Binding SelectedPatient}"
                      SelectionMode="Single"
              
         BorderThickness="1"
                      BorderBrush="#D6D6D6"
                      
   AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      FontSize="14"
                      GridLinesVisibility="Vertical" 
           
              VerticalGridLinesBrush="LightGray">

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Apellidos" Binding="{Binding Surname}" Width="2*"/>

                    <DataGridTextColumn Header="Nombre" Binding="{Binding Name}" Width="1.5*"/>
                    <DataGridTextColumn Header="DNI/NIE" Binding="{Binding 
 DniNie}" Width="*"/>
                    <DataGridTextColumn Header="Teléfono" Binding="{Binding Phone}" Width="*"/>


                    <DataGridCheckBoxColumn Header="Activo" 
                                            Binding="{Binding IsActive}" 
         
                                      Width="Auto"
                                            
                   
                           >


                        <DataGridCheckBoxColumn.ElementStyle>
                            <Style TargetType="CheckBox">

                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="IsEnabled" Value="False"/>

                                <Setter Property="Visibility" 
                                        Value="{Binding DataContext.ShowInactivePatients, 
                                                        RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}, 
                                                        Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </Style>

                        </DataGridCheckBoxColumn.ElementStyle>
                    </DataGridCheckBoxColumn>


                </DataGrid.Columns>
            </DataGrid>
            <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Margin="20,0,0,0">
                <Grid IsEnabled="{Binding IsFormEnabled}">


                    <StackPanel>

                        <Label Content="Nombre:"/>
                        <TextBox Text="{Binding PatientFormModel.Name}"/>

                        <Label Content="Apellidos:"/>

                        <TextBox Text="{Binding PatientFormModel.Surname}"/>


                        <Label Content="DNI/NIE:"/>
                        <TextBox Text="{Binding PatientFormModel.DniNie}"/>

                        <Label Content="Fecha de Nacimiento:"/>

                        <DatePicker SelectedDate="{Binding PatientFormModel.DateOfBirth}" Margin="0,0,0,10"/>


                        <Label Content="Teléfono:"/>
                        <TextBox Text="{Binding PatientFormModel.Phone}"/>

                        <Label Content="Email:"/>

                        <TextBox Text="{Binding PatientFormModel.Email}"/>


                        <Label Content="Dirección:"/>
                        <TextBox Text="{Binding PatientFormModel.Address}"/>

                        <Label Content="Notas:"/>

                        <TextBox 
 Text="{Binding PatientFormModel.Notes}" 
                                 TextWrapping="Wrap" 
                                 MinHeight="100" 
                  
               
    AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"/>

                        <CheckBox Content="Paciente Activo"
                         
            IsChecked="{Binding PatientFormModel.IsActive}"
   
                                Margin="0,15,0,0"
                                  Visibility="{Binding IsFormEnabled, Converter={StaticResource BooleanToVisibilityConverter}}"/>


                    </StackPanel>

                </Grid>
            </ScrollViewer>
        </Grid>

        <Grid Grid.Row="2" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>

            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                <Button Content="&lt;
 Anterior" 
                        Command="{Binding PreviousPageCommand}" 
                        Margin="0,0,5,0"
                        Style="{StaticResource MahApps.Styles.Button.Square}"/>

                <TextBlock Text="{Binding PageInfo}" 
       
                       VerticalAlignment="Center" 
                           FontWeight="SemiBold" 
                           Margin="5,0"/>

                <Button Content="Siguiente &gt;" 
     
                      Command="{Binding NextPageCommand}" 
                        Margin="5,0,0,0"
                        Style="{StaticResource MahApps.Styles.Button.Square}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">


                <Button Content="Eliminar Paciente"
                        Command="{Binding DeletePatientAsyncCommand}" 
                        Margin="0,0,10,0"
           
                        
 Background="IndianRed"
                        Foreground="White"
                        Visibility="{Binding IsPatientSelectedAndActive, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                <Button Content="Reactivar"
                        Command="{Binding ReactivatePatientAsyncCommand}"
         
      
                        Margin="0,0,10,0"
                        Background="SeaGreen"
                        Foreground="White"
                         
  Visibility="{Binding IsPatientSelectedAndInactive, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                <Button Content="Nuevo"
                        Command="{Binding SetNewPatientFormCommand}"
                        Margin="0,0,10,0"/>

                <Button Content="Ver Ficha"
              
             Command="{Binding ViewPatientDetailsCommand}"
                        Margin="0,0,10,0"/>


                <Button Content="Editar"
                        Command="{Binding EditPatientCommand}"
                       
    Margin="0,0,10,0"/>

                <Button Content="Guardar"
                        Command="{Binding SavePatientCommand}"
              
                        IsEnabled="{Binding IsFormEnabled}"
                  
         IsDefault="True"
                        Style="{StaticResource MahApps.Styles.Button.Dialogs.Accent}"/>

            </StackPanel>
        </Grid>
    </Grid>
</UserControl>